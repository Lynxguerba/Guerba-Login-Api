<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GUERBS API</title>
    <link rel="icon" href="images/chatbot.jpg" />

    <!-- BOOTSTRAP -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <!-- BOOTSTRAP ICON -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
    />

    <!-- JQUERY -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- EXTERNAL -->
    <link rel="stylesheet" href="background.css" />
    <link rel="stylesheet" href="wel.css" />
  </head>
  <body>
    <div class="container-fluid">
      <div
        class="container vh-100 d-flex justify-content-center align-items-center w-100"
      >
        <div
          class="welcome-page d-grid justify-content-center align-items-center"
        >
          <div class="row">
            <div
              class="col-12 col-md-6 d-grid justify-content-center align-items-center"
            >
              <p id="welcome-message" class="h3 text-light text-center">
                WELCOME username
              </p>
              <img
                src="images/notification-4.png"
                class="img-fluid"
                alt="welcome-img"
              />
            </div>
            <div
              class="col-12 col-md-6 d-grid justify-content-center align-items-center"
            >
              <div class="w-100">
                <form id="commentForm">
                  <div class="form-floating mb-3">
                    <textarea
                      class="form-control"
                      placeholder="Leave a comment here"
                      id="commentTextarea"
                      style="height: 170px"
                      required
                    ></textarea>
                    <label for="commentTextarea">Comments</label>
                  </div>
                  <button type="submit" class="btn btn-outline-info w-100">
                    SUBMIT
                  </button>
                </form>
                <button class="mt-3 btn btn-info w-100">Sign Out</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      window.onload = function () {
        // Get the query parameter from the URL
        const params = new URLSearchParams(window.location.search);
        const userName = params.get("name");

        // Display the userâ€™s name on the page
        if (userName) {
          document.getElementById("welcome-message").innerHTML =
            "WELCOME " + userName + "!";
        }

        // Submit the comment and username
        document
          .getElementById("commentForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            // Get the comment text
            const commentText =
              document.getElementById("commentTextarea").value;

            // Prepare data to be sent
            const commentData = {
              name: userName,
              comment: commentText,
            };

            // Send the comment data to the server via POST request
            fetch("save_comment.php", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(commentData),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  // Clear the textarea
                  document.getElementById("commentTextarea").value = "";
                  // Load the comments again
                  loadComments();
                } else {
                  console.error("Error saving comment");
                }
              });
          });

        // Load the comments when the page loads
        loadComments();
      };

      function loadComments() {
        fetch("comments.json")
          .then((response) => response.json())
          .then((data) => {
            const commentsSection = document.getElementById("comments-section");
            commentsSection.innerHTML = "";

            data.comments.forEach((comment) => {
              const commentElement = document.createElement("p");
              commentElement.textContent = `${comment.name}: ${comment.comment}`;
              commentsSection.appendChild(commentElement);
            });
          });
      }
    </script>

    <script
      async
      defer
      crossorigin="anonymous"
      src="https://connect.facebook.net/en_US/sdk.js"
    ></script>
  </body>
</html>
